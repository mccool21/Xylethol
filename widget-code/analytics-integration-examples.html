<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Integration Examples</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
            color: #24292e;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .example {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin: 24px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #e1e4e8;
        }
        .example h3 {
            margin-top: 0;
            margin-bottom: 12px;
            color: #24292e;
            font-size: 18px;
            font-weight: 600;
            border-bottom: 1px solid #eaecef;
            padding-bottom: 8px;
        }
        .code {
            background: #f8f9fa;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            padding: 20px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            overflow-x: auto;
            margin: 16px 0;
        }
        .keyword { color: #d73a49; font-weight: 600; }
        .string { color: #032f62; }
        .comment { color: #6a737d; font-style: italic; }
        .function { color: #6f42c1; }
        .property { color: #005cc5; }
        .value { color: #22863a; }
        .demo-buttons {
            margin: 15px 0;
        }
        .demo-buttons button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .demo-buttons button:hover {
            background: #0052a3;
        }
        .analytics-demo {
            background: #f0f8ff;
            border: 2px solid #0066cc;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .event-log {
            background: #1e1e1e;
            color: #d4d4d4;
            border-radius: 8px;
            padding: 16px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .alert-item {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 6px;
            padding: 12px 16px;
            margin-bottom: 10px;
            position: relative;
        }
        .alert-title {
            margin: 0 0 8px 0;
            font-size: 16px;
            font-weight: 600;
            color: #721c24;
        }
        .alert-body {
            margin: 0;
            font-size: 14px;
            color: #721c24;
        }
        .alert-close {
            position: absolute;
            top: 8px;
            right: 12px;
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸŽ¯ Analytics Integration Examples</h1>
            <p>Learn how to integrate the Xylethol Widget with analytics tracking for both alerts and feature toggles.</p>
        </header>

        <div class="example">
            <h3>1. Alert Widget with Analytics</h3>
            <p>Track alert engagement and user interactions:</p>
            <div class="code">
<span class="comment">// Initialize Alert Widget with analytics callbacks</span>
<span class="property">Xylethol</span>.<span class="function">init</span>({
    <span class="property">apiUrl</span>: <span class="string">'http://localhost:3000/api/alerts/widget'</span>,
    <span class="property">userAttributes</span>: {
        <span class="property">userType</span>: <span class="string">'premium'</span>,
        <span class="property">location</span>: <span class="string">'US'</span>,
        <span class="property">planTier</span>: <span class="string">'pro'</span>
    },
    
    <span class="comment">// Analytics Integration</span>
    <span class="property">onAlertShow</span>: <span class="function">function</span>(<span class="value">alert</span>, <span class="value">element</span>) {
        <span class="comment">// Track alert display</span>
        <span class="function">analytics</span>.<span class="function">track</span>(<span class="string">'Alert Shown'</span>, {
            <span class="property">alertId</span>: <span class="value">alert</span>.<span class="property">id</span>,
            <span class="property">alertTitle</span>: <span class="value">alert</span>.<span class="property">title</span>,
            <span class="property">alertTheme</span>: <span class="value">alert</span>.<span class="property">theme</span> || <span class="string">'default'</span>,
            <span class="property">timestamp</span>: <span class="keyword">new</span> <span class="keyword">Date</span>().<span class="function">toISOString</span>()
        });
        
        <span class="comment">// Track time when alert was shown (for engagement metrics)</span>
        <span class="value">element</span>.<span class="property">dataset</span>.<span class="property">shownAt</span> = <span class="keyword">Date</span>.<span class="function">now</span>();
    },
    
    <span class="property">onAlertHide</span>: <span class="function">function</span>(<span class="value">alertId</span>) {
        <span class="comment">// Calculate how long alert was visible</span>
        <span class="keyword">const</span> <span class="value">alertElement</span> = <span class="keyword">document</span>.<span class="function">querySelector</span>(`[data-alert-id="${<span class="value">alertId</span>}"]`);
        <span class="keyword">const</span> <span class="value">shownAt</span> = <span class="value">alertElement</span>?.<span class="property">dataset</span>.<span class="property">shownAt</span>;
        <span class="keyword">const</span> <span class="value">viewTime</span> = <span class="value">shownAt</span> ? <span class="keyword">Date</span>.<span class="function">now</span>() - <span class="function">parseInt</span>(<span class="value">shownAt</span>) : <span class="value">0</span>;
        
        <span class="comment">// Track alert dismissal</span>
        <span class="function">analytics</span>.<span class="function">track</span>(<span class="string">'Alert Dismissed'</span>, {
            <span class="property">alertId</span>: <span class="value">alertId</span>,
            <span class="property">viewTimeMs</span>: <span class="value">viewTime</span>,
            <span class="property">timestamp</span>: <span class="keyword">new</span> <span class="keyword">Date</span>().<span class="function">toISOString</span>()
        });
    },
    
    <span class="property">onError</span>: <span class="function">function</span>(<span class="value">error</span>) {
        <span class="comment">// Track widget errors</span>
        <span class="function">analytics</span>.<span class="function">track</span>(<span class="string">'Alert Widget Error'</span>, {
            <span class="property">error</span>: <span class="value">error</span>.<span class="function">toString</span>(),
            <span class="property">timestamp</span>: <span class="keyword">new</span> <span class="keyword">Date</span>().<span class="function">toISOString</span>()
        });
    },
    
    <span class="property">onNoAlerts</span>: <span class="function">function</span>() {
        <span class="comment">// Track when no alerts are available</span>
        <span class="function">analytics</span>.<span class="function">track</span>(<span class="string">'No Alerts Available'</span>, {
            <span class="property">timestamp</span>: <span class="keyword">new</span> <span class="keyword">Date</span>().<span class="function">toISOString</span>()
        });
    }
});
            </div>
        </div>

        <div class="example">
            <h3>2. Feature Toggle with Analytics</h3>
            <p>Track feature usage and adoption:</p>
            <div class="code">
<span class="comment">// Initialize Feature Toggle with analytics callbacks</span>
<span class="property">Xylethol</span>.<span class="function">init</span>({
    <span class="property">apiUrl</span>: <span class="string">'http://localhost:3000/api/features/check'</span>,
    <span class="property">userId</span>: <span class="string">'user123'</span>,
    <span class="property">userAttributes</span>: {
        <span class="property">userType</span>: <span class="string">'premium'</span>,
        <span class="property">location</span>: <span class="string">'US'</span>,
        <span class="property">planTier</span>: <span class="string">'pro'</span>
    },
    <span class="property">debug</span>: <span class="value">true</span>,
    
    <span class="comment">// Analytics Integration</span>
    <span class="property">onFeatureChange</span>: <span class="function">function</span>(<span class="value">features</span>) {
        <span class="comment">// Track bulk feature checks</span>
        <span class="keyword">Object</span>.<span class="function">entries</span>(<span class="value">features</span>).<span class="function">forEach</span>(([<span class="value">featureName</span>, <span class="value">enabled</span>]) => {
            <span class="function">analytics</span>.<span class="function">track</span>(<span class="string">'Feature Checked'</span>, {
                <span class="property">featureName</span>: <span class="value">featureName</span>,
                <span class="property">enabled</span>: <span class="value">enabled</span>,
                <span class="property">timestamp</span>: <span class="keyword">new</span> <span class="keyword">Date</span>().<span class="function">toISOString</span>()
            });
        });
    },
    
    <span class="property">onError</span>: <span class="function">function</span>(<span class="value">message</span>, <span class="value">error</span>) {
        <span class="comment">// Track feature toggle errors</span>
        <span class="function">analytics</span>.<span class="function">track</span>(<span class="string">'Feature Toggle Error'</span>, {
            <span class="property">message</span>: <span class="value">message</span>,
            <span class="property">error</span>: <span class="value">error</span>.<span class="function">toString</span>(),
            <span class="property">timestamp</span>: <span class="keyword">new</span> <span class="keyword">Date</span>().<span class="function">toISOString</span>()
        });
    }
});

<span class="comment">// Enhanced individual feature checking with analytics</span>
<span class="keyword">async</span> <span class="function">function</span> <span class="function">checkFeatureWithAnalytics</span>(<span class="value">featureName</span>) {
    <span class="keyword">const</span> <span class="value">startTime</span> = <span class="keyword">Date</span>.<span class="function">now</span>();
    
    <span class="keyword">try</span> {
        <span class="keyword">const</span> <span class="value">enabled</span> = <span class="keyword">await</span> <span class="property">Xylethol</span>.<span class="function">check</span>(<span class="value">featureName</span>);
        <span class="keyword">const</span> <span class="value">checkTime</span> = <span class="keyword">Date</span>.<span class="function">now</span>() - <span class="value">startTime</span>;
        
        <span class="comment">// Track individual feature check (if not already tracked by onFeatureChange)</span>
        <span class="function">analytics</span>.<span class="function">track</span>(<span class="string">'Feature Checked'</span>, {
            <span class="property">featureName</span>: <span class="value">featureName</span>,
            <span class="property">enabled</span>: <span class="value">enabled</span>,
            <span class="property">responseTimeMs</span>: <span class="value">checkTime</span>,
            <span class="property">timestamp</span>: <span class="keyword">new</span> <span class="keyword">Date</span>().<span class="function">toISOString</span>()
        });
        
        <span class="keyword">return</span> <span class="value">enabled</span>;
    } <span class="keyword">catch</span> (<span class="value">error</span>) {
        <span class="function">analytics</span>.<span class="function">track</span>(<span class="string">'Feature Check Failed'</span>, {
            <span class="property">featureName</span>: <span class="value">featureName</span>,
            <span class="property">error</span>: <span class="value">error</span>.<span class="function">toString</span>(),
            <span class="property">timestamp</span>: <span class="keyword">new</span> <span class="keyword">Date</span>().<span class="function">toISOString</span>()
        });
        <span class="keyword">throw</span> <span class="value">error</span>;
    }
}
            </div>
        </div>

        <div class="example">
            <h3>3. Xylethol Analytics Service Integration</h3>
            <p>Using the built-in analytics service from your dashboard:</p>
            <div class="code">
<span class="comment">// Import the analytics service (if using modules)</span>
<span class="comment">// import analyticsService from './services/analytics.js';</span>

<span class="comment">// Or include the analytics service script before your widgets</span>
<span class="comment">// &lt;script src="path/to/analytics-service.js">&lt;/script></span>

<span class="comment">// Alert Widget with Xylethol Analytics</span>
<span class="property">Xylethol</span>.<span class="function">init</span>({
    <span class="property">apiUrl</span>: <span class="string">'http://localhost:3000/api/alerts/widget'</span>,
    <span class="property">userAttributes</span>: {
        <span class="property">userType</span>: <span class="string">'premium'</span>,
        <span class="property">location</span>: <span class="string">'US'</span>
    },
    
    <span class="property">onAlertShow</span>: <span class="function">function</span>(<span class="value">alert</span>, <span class="value">element</span>) {
        <span class="comment">// Use Xylethol's analytics service</span>
        <span class="keyword">if</span> (<span class="keyword">window</span>.<span class="property">analyticsService</span>) {
            <span class="keyword">window</span>.<span class="property">analyticsService</span>.<span class="function">trackAlertShow</span>(
                <span class="value">alert</span>.<span class="property">id</span>,
                <span class="value">alert</span>.<span class="property">title</span>,
                <span class="value">alert</span>.<span class="property">theme</span> || <span class="string">'default'</span>,
                <span class="keyword">this</span>.<span class="property">config</span>.<span class="property">userAttributes</span>
            );
        }
    },
    
    <span class="property">onAlertHide</span>: <span class="function">function</span>(<span class="value">alertId</span>) {
        <span class="keyword">if</span> (<span class="keyword">window</span>.<span class="property">analyticsService</span>) {
            <span class="keyword">window</span>.<span class="property">analyticsService</span>.<span class="function">trackAlertHide</span>(
                <span class="value">alertId</span>,
                <span class="keyword">this</span>.<span class="property">config</span>.<span class="property">userAttributes</span>
            );
        }
    }
});

<span class="comment">// Feature Toggle with Xylethol Analytics</span>
<span class="property">Xylethol</span>.<span class="function">init</span>({
    <span class="property">apiUrl</span>: <span class="string">'http://localhost:3000/api/features/check'</span>,
    <span class="property">userId</span>: <span class="string">'user123'</span>,
    
    <span class="property">onFeatureChange</span>: <span class="function">function</span>(<span class="value">features</span>) {
        <span class="keyword">if</span> (<span class="keyword">window</span>.<span class="property">analyticsService</span>) {
            <span class="keyword">window</span>.<span class="property">analyticsService</span>.<span class="function">trackFeatureChange</span>(
                <span class="value">features</span>,
                <span class="keyword">this</span>.<span class="property">instance</span>.<span class="function">getUserAttributes</span>()
            );
        }
    }
});
            </div>
        </div>

        <div class="example">
            <h3>4. Live Demo - Analytics Integration</h3>
            <p>See analytics tracking in action:</p>
            
            <div class="demo-buttons">
                <button onclick="initWithAnalytics()">Initialize with Analytics</button>
                <button onclick="showDemoAlert()">Show Demo Alert</button>
                <button onclick="checkDemoFeature()">Check Demo Feature</button>
                <button onclick="clearEventLog()">Clear Event Log</button>
            </div>

            <div class="analytics-demo">
                <h4>ðŸ“Š Analytics Event Log</h4>
                <div id="event-log" class="event-log">Click "Initialize with Analytics" to start tracking events...</div>
            </div>

            <div id="demo-alert-container"></div>
        </div>

        <div class="example">
            <h3>5. Google Analytics Integration</h3>
            <p>Send events to Google Analytics:</p>
            <div class="code">
<span class="comment">// Google Analytics 4 (gtag) Integration</span>
<span class="property">Xylethol</span>.<span class="function">init</span>({
    <span class="property">apiUrl</span>: <span class="string">'http://localhost:3000/api/alerts/widget'</span>,
    
    <span class="property">onAlertShow</span>: <span class="function">function</span>(<span class="value">alert</span>) {
        <span class="comment">// Send to Google Analytics</span>
        <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="property">gtag</span> !== <span class="string">'undefined'</span>) {
            <span class="property">gtag</span>(<span class="string">'event'</span>, <span class="string">'alert_shown'</span>, {
                <span class="property">custom_parameter_1</span>: <span class="value">alert</span>.<span class="property">id</span>,
                <span class="property">custom_parameter_2</span>: <span class="value">alert</span>.<span class="property">title</span>,
                <span class="property">custom_parameter_3</span>: <span class="value">alert</span>.<span class="property">theme</span>
            });
        }
    },
    
    <span class="property">onAlertHide</span>: <span class="function">function</span>(<span class="value">alertId</span>) {
        <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="property">gtag</span> !== <span class="string">'undefined'</span>) {
            <span class="property">gtag</span>(<span class="string">'event'</span>, <span class="string">'alert_dismissed'</span>, {
                <span class="property">custom_parameter_1</span>: <span class="value">alertId</span>
            });
        }
    }
});
            </div>
        </div>

        <div class="example">
            <h3>6. Custom Analytics Dashboard</h3>
            <p>Send data to your own analytics endpoint:</p>
            <div class="code">
<span class="comment">// Custom Analytics Function</span>
<span class="function">function</span> <span class="function">sendAnalyticsEvent</span>(<span class="value">eventType</span>, <span class="value">eventData</span>) {
    <span class="keyword">fetch</span>(<span class="string">'/api/analytics/track'</span>, {
        <span class="property">method</span>: <span class="string">'POST'</span>,
        <span class="property">headers</span>: {
            <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>
        },
        <span class="property">body</span>: <span class="keyword">JSON</span>.<span class="function">stringify</span>({
            <span class="property">event</span>: <span class="value">eventType</span>,
            <span class="property">data</span>: <span class="value">eventData</span>,
            <span class="property">timestamp</span>: <span class="keyword">new</span> <span class="keyword">Date</span>().<span class="function">toISOString</span>(),
            <span class="property">userId</span>: <span class="function">getCurrentUserId</span>(),
            <span class="property">sessionId</span>: <span class="function">getSessionId</span>()
        })
    }).<span class="function">catch</span>(<span class="value">error</span> => {
        <span class="keyword">console</span>.<span class="function">warn</span>(<span class="string">'Analytics tracking failed:'</span>, <span class="value">error</span>);
    });
}

<span class="comment">// Use with widgets</span>
<span class="property">Xylethol</span>.<span class="function">init</span>({
    <span class="property">onAlertShow</span>: (<span class="value">alert</span>) => <span class="function">sendAnalyticsEvent</span>(<span class="string">'alert_show'</span>, <span class="value">alert</span>),
    <span class="property">onAlertHide</span>: (<span class="value">alertId</span>) => <span class="function">sendAnalyticsEvent</span>(<span class="string">'alert_hide'</span>, { <span class="property">alertId</span> })
});

<span class="property">Xylethol</span>.<span class="function">init</span>({
    <span class="property">onFeatureChange</span>: (<span class="value">features</span>) => <span class="function">sendAnalyticsEvent</span>(<span class="string">'features_checked'</span>, <span class="value">features</span>)
});
            </div>
        </div>

        <div class="example">
            <h3>7. A/B Testing Integration</h3>
            <p>Track feature usage for A/B testing:</p>
            <div class="code">
<span class="comment">// A/B Testing with Feature Toggles</span>
<span class="keyword">async</span> <span class="function">function</span> <span class="function">initABTesting</span>() {
    <span class="comment">// Initialize feature toggle with user variant</span>
    <span class="keyword">const</span> <span class="value">userVariant</span> = <span class="function">getUserABTestVariant</span>(); <span class="comment">// Your A/B testing logic</span>
    
    <span class="property">Xylethol</span>.<span class="function">init</span>({
        <span class="property">apiUrl</span>: <span class="string">'http://localhost:3000/api/features/check'</span>,
        <span class="property">userAttributes</span>: {
            <span class="property">abTestVariant</span>: <span class="value">userVariant</span> <span class="comment">// 'control' or 'experiment'</span>
        },
        
        <span class="property">onFeatureChange</span>: <span class="function">function</span>(<span class="value">features</span>) {
            <span class="comment">// Track feature exposure for A/B testing</span>
            <span class="keyword">Object</span>.<span class="function">entries</span>(<span class="value">features</span>).<span class="function">forEach</span>(([<span class="value">feature</span>, <span class="value">enabled</span>]) => {
                <span class="function">trackABTestExposure</span>(<span class="value">feature</span>, <span class="value">enabled</span>, <span class="value">userVariant</span>);
            });
        }
    });
    
    <span class="comment">// Check experimental feature</span>
    <span class="keyword">const</span> <span class="value">newCheckoutEnabled</span> = <span class="keyword">await</span> <span class="property">Xylethol</span>.<span class="function">check</span>(<span class="string">'new_checkout_flow'</span>);
    
    <span class="keyword">if</span> (<span class="value">newCheckoutEnabled</span>) {
        <span class="comment">// Show experimental checkout</span>
        <span class="function">showNewCheckout</span>();
        <span class="function">trackABTestConversion</span>(<span class="string">'new_checkout_flow'</span>, <span class="string">'exposed'</span>, <span class="value">userVariant</span>);
    } <span class="keyword">else</span> {
        <span class="comment">// Show control checkout</span>
        <span class="function">showOldCheckout</span>();
    }
}

<span class="function">function</span> <span class="function">trackABTestExposure</span>(<span class="value">feature</span>, <span class="value">enabled</span>, <span class="value">variant</span>) {
    <span class="function">analytics</span>.<span class="function">track</span>(<span class="string">'AB Test Exposure'</span>, {
        <span class="property">feature</span>: <span class="value">feature</span>,
        <span class="property">enabled</span>: <span class="value">enabled</span>,
        <span class="property">variant</span>: <span class="value">variant</span>,
        <span class="property">timestamp</span>: <span class="keyword">new</span> <span class="keyword">Date</span>().<span class="function">toISOString</span>()
    });
}
            </div>
        </div>

        <div class="example">
            <h3>8. Performance Monitoring</h3>
            <p>Track widget performance and load times:</p>
            <div class="code">
<span class="comment">// Performance monitoring wrapper</span>
<span class="function">function</span> <span class="function">initWidgetsWithPerformanceTracking</span>() {
    <span class="keyword">const</span> <span class="value">startTime</span> = <span class="keyword">performance</span>.<span class="function">now</span>();
    
    <span class="comment">// Alert Widget with performance tracking</span>
    <span class="property">Xylethol</span>.<span class="function">init</span>({
        <span class="property">apiUrl</span>: <span class="string">'http://localhost:3000/api/alerts/widget'</span>,
        
        <span class="property">onAlertShow</span>: <span class="function">function</span>(<span class="value">alert</span>, <span class="value">element</span>) {
            <span class="comment">// Track render performance</span>
            <span class="keyword">const</span> <span class="value">renderTime</span> = <span class="keyword">performance</span>.<span class="function">now</span>() - <span class="value">startTime</span>;
            
            <span class="function">analytics</span>.<span class="function">track</span>(<span class="string">'Alert Render Performance'</span>, {
                <span class="property">alertId</span>: <span class="value">alert</span>.<span class="property">id</span>,
                <span class="property">renderTimeMs</span>: <span class="value">renderTime</span>,
                <span class="property">theme</span>: <span class="value">alert</span>.<span class="property">theme</span>
            });
        },
        
        <span class="property">onError</span>: <span class="function">function</span>(<span class="value">error</span>) {
            <span class="comment">// Track widget errors with performance context</span>
            <span class="function">analytics</span>.<span class="function">track</span>(<span class="string">'Widget Error'</span>, {
                <span class="property">widget</span>: <span class="string">'alert'</span>,
                <span class="property">error</span>: <span class="value">error</span>.<span class="function">toString</span>(),
                <span class="property">loadTimeMs</span>: <span class="keyword">performance</span>.<span class="function">now</span>() - <span class="value">startTime</span>
            });
        }
    });
    
    <span class="comment">// Feature Toggle with cache performance tracking</span>
    <span class="property">Xylethol</span>.<span class="function">init</span>({
        <span class="property">apiUrl</span>: <span class="string">'http://localhost:3000/api/features/check'</span>,
        
        <span class="property">onFeatureChange</span>: <span class="function">function</span>(<span class="value">features</span>) {
            <span class="comment">// Track cache performance</span>
            <span class="keyword">const</span> <span class="value">cacheStats</span> = <span class="property">Xylethol</span>.<span class="function">getCacheStats</span>();
            
            <span class="function">analytics</span>.<span class="function">track</span>(<span class="string">'Feature Cache Performance'</span>, {
                <span class="property">cacheSize</span>: <span class="value">cacheStats</span>.<span class="property">size</span>,
                <span class="property">featuresChecked</span>: <span class="keyword">Object</span>.<span class="function">keys</span>(<span class="value">features</span>).<span class="property">length</span>
            });
        }
    });
}
            </div>
        </div>
    </div>

    <!-- Include widget libraries -->
    <script src="alert-widget.js"></script>
    <script src="feature-toggle.js"></script>
    
    <script>
        // Mock analytics service for demo
        const eventLog = [];
        
        function logEvent(type, data) {
            const event = {
                type,
                data,
                timestamp: new Date().toISOString()
            };
            eventLog.push(event);
            updateEventLog();
        }
        
        function updateEventLog() {
            const logElement = document.getElementById('event-log');
            if (eventLog.length === 0) {
                logElement.textContent = 'No events logged yet...';
                return;
            }
            
            const logText = eventLog
                .slice(-10) // Show last 10 events
                .map(event => `[${event.timestamp}] ${event.type}: ${JSON.stringify(event.data, null, 2)}`)
                .join('\n\n');
            
            logElement.textContent = logText;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function initWithAnalytics() {
            // Initialize Xylethol Widget with analytics for both alerts and features
            Xylethol.init({
                alerts: {
                    apiUrl: 'http://localhost:3000/api/alerts/widget',
                    containerId: 'demo-alert-container',
                    onAlertShow: function(alert, element) {
                        logEvent('Alert Shown', {
                            alertId: alert.id,
                            title: alert.title,
                            theme: alert.theme || 'default'
                        });
                    },
                    onAlertHide: function(alertId) {
                        logEvent('Alert Hidden', { alertId });
                    },
                    onError: function(error) {
                        logEvent('Alert Error', { error: error.toString() });
                    },
                    onNoAlerts: function() {
                        logEvent('No Alerts', {});
                    }
                },
                features: {
                    apiUrl: 'http://localhost:3000/api/features/check',
                    userId: 'demo-user-123',
                    debug: true,
                    onFeatureChange: function(features) {
                        logEvent('Features Checked', features);
                    },
                    onError: function(message, error) {
                        logEvent('Feature Error', { message, error: error.toString() });
                    }
                },
                userAttributes: {
                    userType: 'premium',
                    location: 'US'
                }
            });
            
            logEvent('Widgets Initialized', { timestamp: new Date().toISOString() });
        }
        
        function showDemoAlert() {
            // Create a demo alert when API isn't available
            const demoAlert = {
                id: `demo-${Date.now()}`,
                title: 'Demo Analytics Alert',
                body: 'This alert demonstrates analytics tracking in action!'
            };
            
            const container = document.getElementById('demo-alert-container');
            const alertElement = document.createElement('div');
            alertElement.className = 'alert-item';
            alertElement.dataset.alertId = demoAlert.id;
            alertElement.innerHTML = `
                <h4 class="alert-title">${demoAlert.title}</h4>
                <p class="alert-body">${demoAlert.body}</p>
                <button class="alert-close" onclick="hideDemoAlert('${demoAlert.id}')">&times;</button>
            `;
            
            container.appendChild(alertElement);
            
            // Trigger analytics callback manually
            if (window.Xylethol && window.Xylethol.instance) {
                const config = window.Xylethol.instance.config;
                if (config.onAlertShow) {
                    config.onAlertShow(demoAlert, alertElement);
                }
            }
        }
        
        function hideDemoAlert(alertId) {
            const alertElement = document.querySelector(`[data-alert-id="${alertId}"]`);
            if (alertElement) {
                alertElement.remove();
                
                // Trigger analytics callback manually
                if (window.Xylethol && window.Xylethol.instance) {
                    const config = window.Xylethol.instance.config;
                    if (config.onAlertHide) {
                        config.onAlertHide(alertId);
                    }
                }
            }
        }
        
        async function checkDemoFeature() {
            try {
                // Try to check a real feature
                const features = await Xylethol.checkFeatures(['demo_feature', 'analytics_demo']);
                logEvent('Demo Feature Check', features);
            } catch (error) {
                // Fallback for demo - simulate feature check
                const mockFeatures = {
                    'demo_feature': Math.random() > 0.5,
                    'analytics_demo': true
                };
                logEvent('Demo Feature Check (Mock)', mockFeatures);
            }
        }
        
        function clearEventLog() {
            eventLog.length = 0;
            updateEventLog();
        }
        
        // Initialize event log display
        updateEventLog();
    </script>
</body>
</html>